(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))d(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function i(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(a){if(a.ep)return;a.ep=!0;const s=i(a);fetch(a.href,s)}})();const n={uaState:document.getElementById("uaState"),regState:document.getElementById("regState"),callState:document.getElementById("callState"),log:document.getElementById("log"),pbxHost:document.getElementById("pbxHost"),ext:document.getElementById("ext"),pwd:document.getElementById("pwd"),dialTo:document.getElementById("dialTo"),remoteAudio:document.getElementById("remoteAudio"),localAudio:document.getElementById("localAudio"),btnStart:document.getElementById("btnStart"),btnStop:document.getElementById("btnStop"),btnRegister:document.getElementById("btnRegister"),btnUnregister:document.getElementById("btnUnregister"),btnCall:document.getElementById("btnCall"),btnAnswer:document.getElementById("btnAnswer"),btnHangup:document.getElementById("btnHangup"),btnMute:document.getElementById("btnMute"),btnUnmute:document.getElementById("btnUnmute")},B=typeof window<"u"&&!!window.baresip;function r(...e){const t=e.map(i=>typeof i=="string"?i:JSON.stringify(i,null,2)).join(" ");console.log(...e),n.log.textContent=`${new Date().toLocaleTimeString()}  ${t}
`+n.log.textContent}function I(e,t){e.textContent=t}function E(e,t,i){I(e,t),e.classList.remove("ok","warn","bad"),i&&e.classList.add(i)}function g(e){const t=e==="established"?"ok":e==="idle"?"warn":"bad";E(n.callState,e,t)}function o(e){const t=e==="started"?"ok":e==="stopped"?"bad":"warn";E(n.uaState,e,t),n.btnStart.classList.toggle("btn-ok",e==="started")}function l(e){const t=e==="registered"?"ok":e==="failed"?"bad":"warn";E(n.regState,e,t),n.btnRegister.classList.toggle("btn-ok",e==="registered")}function c({canAnswer:e,inCall:t}){n.btnAnswer.disabled=!e,n.btnHangup.disabled=!t,n.btnMute.disabled=!t,n.btnUnmute.disabled=!t}let m,b,p,f,w,y,S;B?(window.baresip.onLog(e=>r(e)),window.baresip.onState(e=>{e.ua&&o(e.ua),e.reg&&l(e.reg),e.call&&(g(e.call),e.call==="incoming"?c({canAnswer:!0,inCall:!0}):e.call==="established"||e.call==="establishing"?c({canAnswer:!1,inCall:!0}):c({canAnswer:!1,inCall:!1}))}),m=async()=>{o("starting");const e=n.pbxHost.value.trim(),t=n.ext.value.trim(),i=n.pwd.value,d=t;if(!e||!t||!i){alert("Please fill PBX Host, Extension, Password.");return}const a=`sip:${t}@${e};auth_user=${t};auth_pass=${i};display_name=${d}`;await window.baresip.start({account:a}),o("started"),r("baresip started.")},b=async()=>{await window.baresip.stop(),o("stopped"),l("not registered"),g("idle"),r("baresip stopped.")},p=async()=>{if(n.uaState.textContent!=="started"){alert("Start UA first and wait for UA to be ready.");return}l("registering"),await window.baresip.command("/uareg 300"),r("Register request sent.")},f=async()=>{l("unregistering"),await window.baresip.command("/uareg 0"),r("Unregister request sent.")},w=async()=>{const e=n.pbxHost.value.trim(),t=n.dialTo.value.trim();if(!t)return alert("Enter a target extension/number.");const i=`sip:${t}@${e}`;await window.baresip.command(`/dial ${i}`),r("Calling",t)},y=async()=>{await window.baresip.command("/accept"),r("Call answered.")},S=async()=>{await window.baresip.command("/hangup"),r("Hangup.")}):(r("Baresip is not available. Run this in Electron with baresip installed."),m=async()=>alert("Baresip not available. Run in Electron."),b=async()=>{},p=async()=>{},f=async()=>{},w=async()=>{},y=async()=>{},S=async()=>{});function h(e){r("Mute/unmute handled by baresip. Use its CLI if needed.")}n.btnStart.addEventListener("click",()=>m().catch(e=>r("Start error:",String(e))));n.btnStop.addEventListener("click",()=>b().catch(e=>r("Stop error:",String(e))));n.btnRegister.addEventListener("click",()=>p().catch(e=>r("Register error:",String(e))));n.btnUnregister.addEventListener("click",()=>f().catch(e=>r("Unregister error:",String(e))));n.btnCall.addEventListener("click",()=>w().catch(e=>r("Call error:",String(e))));n.btnAnswer.addEventListener("click",()=>y().catch(e=>r("Answer error:",String(e))));n.btnHangup.addEventListener("click",()=>S().catch(e=>r("Hangup error:",String(e))));n.btnMute.addEventListener("click",()=>h());n.btnUnmute.addEventListener("click",()=>h());c({canAnswer:!1,inCall:!1});o("stopped");l("not registered");g("idle");r("Ready. Fill PBX host/ws and start UA.");
